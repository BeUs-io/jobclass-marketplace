import{F as u,R as S,a as l,b as f,k as d,n as a,r as c}from"./chunk-WKEOFE6Q.js";var v=(()=>{class g{constructor(){this.currentUserSubject=new d(null),this.currentUser$=this.currentUserSubject.asObservable(),this.verificationTokensSubject=new d(new Map),this.resetTokensSubject=new d(new Map),this.isAuthenticatedSubject=new d(!1),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.loadCurrentUser(),this.initializeSocialLoginListeners()}loadCurrentUser(){let e=localStorage.getItem("currentUser"),t=localStorage.getItem("authToken");if(e&&t){let s=JSON.parse(e);s.createdAt=new Date(s.createdAt),s.lastLogin=new Date(s.lastLogin),this.currentUserSubject.next(s),this.isAuthenticatedSubject.next(!0)}}register(e,t,s,r){return a(null).pipe(u(1e3),c(()=>{let n=JSON.parse(localStorage.getItem("users")||"[]");if(n.find(p=>p.email===e))return{success:!1,message:"Email already registered"};let i={id:"user_"+Date.now(),email:e,name:s,role:r,emailVerified:!1,twoFactorEnabled:!1,provider:"email",createdAt:new Date,lastLogin:new Date,avatar:`https://ui-avatars.com/api/?name=${s}&background=random`};n.push(f(l({},i),{password:t})),localStorage.setItem("users",JSON.stringify(n));let o=this.generateToken(),m={email:e,token:o,expiresAt:new Date(Date.now()+24*60*60*1e3),verified:!1},h=this.verificationTokensSubject.value;return h.set(e,m),this.verificationTokensSubject.next(h),this.sendVerificationEmail(e,o),{success:!0,message:"Registration successful. Please check your email to verify your account.",user:i,requiresVerification:!0}}))}login(e,t){return a(null).pipe(u(1e3),c(()=>{let r=JSON.parse(localStorage.getItem("users")||"[]").find(o=>o.email===e&&o.password===t);if(!r)return{success:!1,message:"Invalid email or password"};if(!r.emailVerified)return{success:!1,message:"Please verify your email before logging in",requiresVerification:!0};let n=this.generateToken(),i=this.generateToken();return r.lastLogin=new Date,localStorage.setItem("authToken",n),localStorage.setItem("refreshToken",i),localStorage.setItem("currentUser",JSON.stringify(r)),this.currentUserSubject.next(r),this.isAuthenticatedSubject.next(!0),{success:!0,message:"Login successful",user:r,token:n,refreshToken:i,requires2FA:r.twoFactorEnabled}}))}loginWithGoogle(){return a(null).pipe(u(1500),c(()=>{let e={id:"google_"+Date.now(),email:"user@gmail.com",name:"John Doe",avatar:"https://lh3.googleusercontent.com/a/default-user=s96-c",provider:"google",providerId:"google_123456"},t=f(l({},e),{role:"candidate",emailVerified:!0,twoFactorEnabled:!1,createdAt:new Date,lastLogin:new Date}),s=this.generateToken();return localStorage.setItem("authToken",s),localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0),{success:!0,message:"Successfully logged in with Google",user:t,token:s}}))}loginWithLinkedIn(){return a(null).pipe(u(1500),c(()=>{let e={id:"linkedin_"+Date.now(),email:"professional@linkedin.com",name:"Jane Smith",avatar:"https://media.licdn.com/dms/image/default-profile",provider:"linkedin",providerId:"linkedin_789012",profile:{bio:"Senior Software Engineer with 10+ years experience",company:"TechCorp",position:"Senior Developer",location:"San Francisco, CA"}},t=f(l({},e),{role:"candidate",emailVerified:!0,twoFactorEnabled:!1,createdAt:new Date,lastLogin:new Date}),s=this.generateToken();return localStorage.setItem("authToken",s),localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0),{success:!0,message:"Successfully logged in with LinkedIn",user:t,token:s}}))}loginWithGitHub(){return a(null).pipe(u(1500),c(()=>{let e={id:"github_"+Date.now(),email:"developer@github.com",name:"Dev User",avatar:"https://avatars.githubusercontent.com/u/1234567",provider:"github",providerId:"github_345678",profile:{bio:"Full-stack developer | Open source contributor",website:"https://github.com/devuser",location:"Remote",socialLinks:{github:"https://github.com/devuser"}}},t=f(l({},e),{role:"candidate",emailVerified:!0,twoFactorEnabled:!1,createdAt:new Date,lastLogin:new Date}),s=this.generateToken();return localStorage.setItem("authToken",s),localStorage.setItem("currentUser",JSON.stringify(t)),this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0),{success:!0,message:"Successfully logged in with GitHub",user:t,token:s}}))}verifyEmail(e){return a(null).pipe(u(1e3),c(()=>{let t=this.verificationTokensSubject.value,s,r;if(t.forEach((o,m)=>{o.token===e&&(s=o,r=m)}),!s||!r)return{success:!1,message:"Invalid or expired verification token"};if(new Date>s.expiresAt)return{success:!1,message:"Verification token has expired"};let n=JSON.parse(localStorage.getItem("users")||"[]"),i=n.find(o=>o.email===r);return i?(i.emailVerified=!0,localStorage.setItem("users",JSON.stringify(n)),t.delete(r),this.verificationTokensSubject.next(t),{success:!0,message:"Email verified successfully. You can now log in.",user:i}):{success:!1,message:"User not found"}}))}resendVerificationEmail(e){return a(null).pipe(u(1e3),c(()=>{let s=JSON.parse(localStorage.getItem("users")||"[]").find(o=>o.email===e);if(!s)return{success:!1,message:"Email not found"};if(s.emailVerified)return{success:!1,message:"Email is already verified"};let r=this.generateToken(),n={email:e,token:r,expiresAt:new Date(Date.now()+24*60*60*1e3),verified:!1},i=this.verificationTokensSubject.value;return i.set(e,n),this.verificationTokensSubject.next(i),this.sendVerificationEmail(e,r),{success:!0,message:"Verification email sent successfully"}}))}requestPasswordReset(e){return a(null).pipe(u(1e3),c(()=>{if(!JSON.parse(localStorage.getItem("users")||"[]").find(o=>o.email===e))return{success:!0,message:"If an account exists with this email, a password reset link has been sent."};let r=this.generateToken(),n={email:e,token:r},i=this.resetTokensSubject.value;return i.set(r,n),this.resetTokensSubject.next(i),this.sendPasswordResetEmail(e,r),{success:!0,message:"Password reset email sent successfully"}}))}resetPassword(e,t){return a(null).pipe(u(1e3),c(()=>{let s=this.resetTokensSubject.value,r=s.get(e);if(!r)return{success:!1,message:"Invalid or expired reset token"};let n=JSON.parse(localStorage.getItem("users")||"[]"),i=n.find(o=>o.email===r.email);return i?(i.password=t,localStorage.setItem("users",JSON.stringify(n)),s.delete(e),this.resetTokensSubject.next(s),{success:!0,message:"Password reset successfully. You can now log in with your new password."}):{success:!1,message:"User not found"}}))}changePassword(e,t){return a(null).pipe(u(1e3),c(()=>{let s=this.currentUserSubject.value;if(!s)return{success:!1,message:"Not authenticated"};let r=JSON.parse(localStorage.getItem("users")||"[]"),n=r.find(i=>i.email===s.email);return!n||n.password!==e?{success:!1,message:"Current password is incorrect"}:(n.password=t,localStorage.setItem("users",JSON.stringify(r)),{success:!0,message:"Password changed successfully"})}))}enable2FA(){return a(null).pipe(u(1e3),c(()=>{let e=this.currentUserSubject.value;return e?(e.twoFactorEnabled=!0,this.currentUserSubject.next(e),localStorage.setItem("currentUser",JSON.stringify(e)),{success:!0,message:"Two-factor authentication enabled successfully"}):{success:!1,message:"Not authenticated"}}))}verify2FA(e){return a(null).pipe(u(1e3),c(()=>e==="123456"?{success:!0,message:"2FA verification successful"}:{success:!1,message:"Invalid 2FA code"}))}logout(){localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}refreshToken(){return localStorage.getItem("refreshToken")?a(null).pipe(u(500),c(()=>{let t=this.generateToken();return localStorage.setItem("authToken",t),{success:!0,message:"Token refreshed",token:t}})):a({success:!1,message:"No refresh token found"})}generateToken(){return Math.random().toString(36).substr(2)+Date.now().toString(36)}sendVerificationEmail(e,t){let s=`${window.location.origin}/verify-email?token=${t}`;console.log(`\u{1F4E7} Verification email sent to ${e}`),console.log(`Verification URL: ${s}`)}sendPasswordResetEmail(e,t){let s=`${window.location.origin}/reset-password?token=${t}`;console.log(`\u{1F4E7} Password reset email sent to ${e}`),console.log(`Reset URL: ${s}`)}initializeSocialLoginListeners(){console.log("Social login providers initialized")}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}updateProfile(e){return a(null).pipe(u(1e3),c(()=>{let t=this.currentUserSubject.value;return t?(t.profile=l(l({},t.profile),e),this.currentUserSubject.next(t),localStorage.setItem("currentUser",JSON.stringify(t)),{success:!0,message:"Profile updated successfully",user:t}):{success:!1,message:"Not authenticated"}}))}static{this.\u0275fac=function(t){return new(t||g)}}static{this.\u0275prov=S({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();export{v as a};
